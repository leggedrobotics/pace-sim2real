
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the PACE sim-to-real pipeline for legged robots.">
      
      
      
        <link rel="canonical" href="https://pace.filipbjelonic.com/tutorials/advanced/">
      
      
        <link rel="prev" href="../basics/">
      
      
        <link rel="next" href="../best_practice/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Advanced - PACE Sim2Real</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../styles/pace-colors.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-tutorial-tailoring-the-optimization-to-your-needs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PACE Sim2Real" class="md-header__button md-logo" aria-label="PACE Sim2Real" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PACE Sim2Real
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/leggedrobotics/pace-sim2real" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    leggedrobotics/pace-sim2real
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../installation/" class="md-tabs__link">
          
  
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../basics/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PACE Sim2Real" class="md-nav__button md-logo" aria-label="PACE Sim2Real" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    PACE Sim2Real
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/leggedrobotics/pace-sim2real" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    leggedrobotics/pace-sim2real
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../importing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Importing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/anymal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ANYmal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#extension-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extension Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extension Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-inherit-and-extend" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Inherit and extend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-direct-modification" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Direct modification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-the-optimization-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding the Optimization Pipeline
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-the-optimization-objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changing the Optimization Objective
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changing the Optimization Objective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weighted-joint-position-velocity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weighted joint position + velocity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#velocity-only-identification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Velocity-only identification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-effector-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        End-effector error
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-or-modifying-optimized-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding or Modifying Optimized Parameters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding or Modifying Optimized Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding new parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameter-normalization-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameter Normalization Strategy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Convergence Control
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging &amp; Monitoring
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-and-tips" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Pitfalls and Tips
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommended-workflow-for-custom-optimizers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recommended Workflow for Custom Optimizers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../best_practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Best practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#extension-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extension Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extension Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-inherit-and-extend" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Inherit and extend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-direct-modification" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Direct modification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-the-optimization-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding the Optimization Pipeline
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-the-optimization-objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changing the Optimization Objective
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changing the Optimization Objective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weighted-joint-position-velocity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weighted joint position + velocity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#velocity-only-identification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Velocity-only identification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-effector-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        End-effector error
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-or-modifying-optimized-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding or Modifying Optimized Parameters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding or Modifying Optimized Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding new parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameter-normalization-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameter Normalization Strategy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Convergence Control
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging &amp; Monitoring
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-and-tips" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Pitfalls and Tips
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommended-workflow-for-custom-optimizers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recommended Workflow for Custom Optimizers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="advanced-tutorial-tailoring-the-optimization-to-your-needs">Advanced Tutorial: Tailoring the Optimization to Your Needs<a class="headerlink" href="#advanced-tutorial-tailoring-the-optimization-to-your-needs" title="Permanent link">&para;</a></h1>
<p>This advanced tutorial explains how to <strong>customize and extend the PACE optimization pipeline</strong> for specialized research and hardware requirements. It is intended for users who want to go beyond the default setup and adapt the evolutionary process to their specific system identification or sim-to-real objectives.</p>
<p>The core optimization logic of PACE is implemented in:</p>
<div class="highlight"><pre><span></span><code>pace-sim2real/source/pace_sim2real/pace_sim2real/optim/cma_es.py
</code></pre></div>
<p>This file defines the <code>CMAESOptimizer</code> class, which orchestrates population sampling, evaluation, simulator parameter updates, convergence monitoring, and logging. Understanding and modifying this class enables fine-grained control over the entire identification process.</p>
<p>The class can be imported using
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pace_sim2real</span><span class="w"> </span><span class="kn">import</span> <span class="n">CMAESOptimizer</span>
</code></pre></div></p>
<hr />
<h2 id="extension-strategies">Extension Strategies<a class="headerlink" href="#extension-strategies" title="Permanent link">&para;</a></h2>
<p>Advanced users typically follow one of two approaches:</p>
<h3 id="1-inherit-and-extend">1. Inherit and extend<a class="headerlink" href="#1-inherit-and-extend" title="Permanent link">&para;</a></h3>
<p>Create a new optimizer file in the same directory and inherit from <code>CMAESOptimizer</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CustomCMAESOptimizer</span><span class="p">(</span><span class="n">CMAESOptimizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_dof_pos</span><span class="p">,</span> <span class="n">real_dof_pos</span><span class="p">):</span>
        <span class="c1"># Custom loss or scoring logic</span>
        <span class="k">pass</span>
</code></pre></div>
<p>This maintains compatibility with future PACE updates while allowing isolated customization.</p>
<h3 id="2-direct-modification">2. Direct modification<a class="headerlink" href="#2-direct-modification" title="Permanent link">&para;</a></h3>
<p>Modify <code>cma_es.py</code> directly if you need tight integration or experimental changes that deviate significantly from the default interface.</p>
<p>This is useful for:</p>
<ul>
<li>Research prototypes</li>
<li>Heavily custom cost functions</li>
<li>Alternative parameter representations</li>
</ul>
<hr />
<h2 id="understanding-the-optimization-pipeline">Understanding the Optimization Pipeline<a class="headerlink" href="#understanding-the-optimization-pipeline" title="Permanent link">&para;</a></h2>
<p>Each CMA-ES generation follows the sequence:</p>
<ol>
<li><strong>ask()</strong> – Sample a population of normalized parameters</li>
<li><strong>Simulator Update</strong> – Apply parameters to simulator</li>
<li><strong>Simulation Rollout</strong> – Generate joint trajectories</li>
<li><strong>tell(...)</strong> – Accumulate score over trajectories</li>
<li><strong>evolve()</strong> – CMA-ES update step</li>
<li><strong>Logging + Checkpointing</strong></li>
</ol>
<p>This loop continues until either:</p>
<ul>
<li><code>max_iteration</code> is reached, or</li>
<li>Convergence is detected via <code>epsilon</code></li>
</ul>
<hr />
<h2 id="changing-the-optimization-objective">Changing the Optimization Objective<a class="headerlink" href="#changing-the-optimization-objective" title="Permanent link">&para;</a></h2>
<p>The default objective minimizes joint position tracking error with bias compensation:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_dof_pos</span><span class="p">,</span> <span class="n">real_dof_pos</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">sim_dof_pos</span> <span class="o">-</span> <span class="n">real_dof_pos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_params</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_idx</span><span class="p">]),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>Advanced objectives can be implemented inside the <code>tell()</code> method.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<h4 id="weighted-joint-position-velocity">Weighted joint position + velocity<a class="headerlink" href="#weighted-joint-position-velocity" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">error_pos</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sim_dof_pos</span> <span class="o">-</span> <span class="n">real_dof_pos</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">error_vel</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sim_dof_vel</span> <span class="o">-</span> <span class="n">real_dof_vel</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">+=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">error_pos</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">error_vel</span>
</code></pre></div>
<h4 id="velocity-only-identification">Velocity-only identification<a class="headerlink" href="#velocity-only-identification" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sim_dof_vel</span> <span class="o">-</span> <span class="n">real_dof_vel</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<h4 id="end-effector-error">End-effector error<a class="headerlink" href="#end-effector-error" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">error</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sim_ee_pose</span> <span class="o">-</span> <span class="n">real_ee_pose</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">+=</span> <span class="n">error</span>
</code></pre></div>
<p>This allows optimization tailored to:</p>
<ul>
<li>Contact dynamics</li>
<li>Compliance tuning</li>
<li>Task-space behavior</li>
</ul>
<hr />
<h2 id="adding-or-modifying-optimized-parameters">Adding or Modifying Optimized Parameters<a class="headerlink" href="#adding-or-modifying-optimized-parameters" title="Permanent link">&para;</a></h2>
<p>By default, the optimizer tunes:</p>
<ul>
<li>Joint armature</li>
<li>Viscous damping</li>
<li>Coulomb friction</li>
<li>Encoder bias</li>
<li>Encoder delay</li>
</ul>
<p>The parameter vector is structured as:</p>
<div class="highlight"><pre><span></span><code>[ armature | damping | friction | bias | delay ]
</code></pre></div>
<h3 id="adding-new-parameters">Adding new parameters<a class="headerlink" href="#adding-new-parameters" title="Permanent link">&para;</a></h3>
<p>For example, to add torque saturation:</p>
<ol>
<li>Extend bounds tensor</li>
<li>Increase param dimensionality</li>
<li>Add index slices</li>
<li>Apply to simulator in <code>update_simulator()</code></li>
</ol>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="n">torque_limit_idx</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">num_joints</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">num_joints</span><span class="p">)</span>
</code></pre></div>
<p>Then write into the simulator accordingly.</p>
<hr />
<h2 id="parameter-normalization-strategy">Parameter Normalization Strategy<a class="headerlink" href="#parameter-normalization-strategy" title="Permanent link">&para;</a></h2>
<p>All CMA-ES parameters operate in normalized space ∈ [-1, 1]. These are mapped to physical values via:</p>
<div class="highlight"><pre><span></span><code>sim_params = bounds_min + (params + 1)/2 * (bounds_max - bounds_min)
</code></pre></div>
<p>This ensures numerical stability and consistent scaling across heterogeneous parameters.</p>
<hr />
<h2 id="convergence-control">Convergence Control<a class="headerlink" href="#convergence-control" title="Permanent link">&para;</a></h2>
<p>Stopping occurs when:</p>
<ul>
<li><code>iteration &gt;= max_iteration</code></li>
<li>OR score variance &lt; epsilon</li>
</ul>
<p>The metric used:</p>
<div class="highlight"><pre><span></span><code>(max_score - min_score) / min_score
</code></pre></div>
<p>You may replace this with more sophisticated criteria such as:</p>
<ul>
<li>Fitness gradient threshold</li>
<li>Moving average plateaus</li>
<li>Early stopping windows</li>
</ul>
<hr />
<h2 id="logging-monitoring">Logging &amp; Monitoring<a class="headerlink" href="#logging-monitoring" title="Permanent link">&para;</a></h2>
<p>TensorBoard metrics recorded include:</p>
<ul>
<li>Parameter distributions per joint</li>
<li>Best parameter evolution</li>
<li>Score curves</li>
<li>Delay histograms</li>
</ul>
<p>Checkpoints saved:</p>
<ul>
<li>Best trajectory (<code>best_trajectory.pt</code>)</li>
<li>Mean parameters</li>
<li>Full progress (optional)</li>
</ul>
<p>This enables:</p>
<ul>
<li>Offline analysis</li>
<li>Reproducibility</li>
<li>Debugging of convergence behavior</li>
</ul>
<hr />
<h2 id="common-pitfalls-and-tips">Common Pitfalls and Tips<a class="headerlink" href="#common-pitfalls-and-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>Avoid multi-scale parameters without normalization</li>
<li>Ensure score magnitude remains stable across iterations</li>
<li>Use histograms to detect parameter collapse</li>
<li>Do not mix physical units inside loss</li>
</ul>
<hr />
<h2 id="recommended-workflow-for-custom-optimizers">Recommended Workflow for Custom Optimizers<a class="headerlink" href="#recommended-workflow-for-custom-optimizers" title="Permanent link">&para;</a></h2>
<ol>
<li>Clone base implementation</li>
<li>Define new loss component</li>
<li>Visualize score evolution</li>
<li>Analyze parameter histograms</li>
<li>Validate on multiple trajectories</li>
<li>Deploy to hardware carefully</li>
</ol>
<hr />
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>The CMA-ES optimizer in PACE is designed for extensibility, transparency, and research flexibility. By customizing its objective, parameters, and convergence logic, users can tailor the system identification process to highly specific real-world challenges — from actuator modeling to task-specific sim-to-real transfer.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../basics/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basics">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Basics
              </div>
            </div>
          </a>
        
        
          
          <a href="../best_practice/" class="md-footer__link md-footer__link--next" aria-label="Next: Best practices">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Best practices
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.highlight", "search.suggest", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>